# v0.2 Execution Plan

This plan converts the current v0.2 backlog into weekly, testable milestones.
It is designed for deterministic, contract-first delivery aligned with repo guardrails.

## Goals for v0.2 delivery

1. Deliver optimizer strategy composition (staged + portfolio baseline).
2. Implement first-class constraint handling (penalty + feasibility metadata).
3. Improve reporting/artifacts for sweep and optimization runs.
4. Close ADR/documentation gaps so roadmap, contracts, and implementation remain synchronized.

## Delivery principles

- No public contract breaks without ADR + versioning updates.
- Determinism is mandatory for all new public entrypoints and strategy paths.
- Every milestone includes proof-of-decision tests and doc updates.

---

## Milestone timeline (12 weeks)

### Weeks 1–2: Alignment + ADR closure

**Outcomes**
- Resolve roadmap/status drift.
- Land missing ADRs for determinism policy and optimization composition semantics.
- Produce design checklist for constraint handling and reporting artifacts.

**Deliverables**
- ADR: determinism policy (seed derivation + accepted tolerances).
- ADR: optimization interface composition (staged/portfolio semantics).
- STATUS.md updates reflecting real implemented vs planned features.

**Acceptance checks**
- Docs mention identical v0.2 scope across roadmap + ADR + STATUS.
- New ADRs include validation sections with test references.

### Weeks 3–5: Constraint handling v1

**Outcomes**
- Add explicit constraint representation usable by runner/strategies.
- Implement deterministic penalty/feasibility evaluation.

**Deliverables**
- Constraint model in ML layer (no simulation-specific assumptions).
- Runner support for penalty-adjusted objective and feasibility metadata.
- Tests for deterministic penalty outcomes and metadata integrity.

**Acceptance checks**
- Same candidate + same seed => same penalty and objective trace.
- OptimizationHistory captures constraint-related metadata consistently.

### Weeks 6–8: Strategy composition v1

**Outcomes**
- Add composable strategy orchestration (staged and portfolio baseline).

**Deliverables**
- Composition strategy interface over existing `OptimizerStrategy` contract.
- `StagedStrategy` baseline (phase transitions with explicit criteria).
- `PortfolioStrategy` baseline (allocation policy and deterministic selection).
- Integration tests with dummy evaluator validating ask/tell ordering.

**Acceptance checks**
- Composition behavior is deterministic under fixed seed.
- ask/tell sequences preserve canonical result contracts.

### Weeks 9–10: Reporting improvements

**Outcomes**
- Standardize run artifact bundles for analysis and reruns.

**Deliverables**
- Canonical run summary artifact (metadata + best point + key metrics).
- Optional comparative reporting helper for multiple runs.
- Documentation update for expected artifact layouts.

**Acceptance checks**
- End-to-end test verifies report artifacts and stable field naming.
- Existing plotting/reporting contracts remain backward compatible.

### Weeks 11–12: Hardening + release prep

**Outcomes**
- Stabilize CI behavior and prepare v0.2 release cut.

**Deliverables**
- Full regression run and cleanup of flaky/slow-path issues.
- Release notes draft with migration guidance.
- Version bump and final STATUS/roadmap synchronization.

**Acceptance checks**
- Required checks green (`pre-commit`, `mypy`, fast pytest).
- v0.2 checklist reflects actual shipped capabilities.

---

## Workstream issue map

Use this as the issue/PR decomposition template:

- **WS1: ADR + docs synchronization**
  - ADR determinism policy.
  - ADR optimization composition semantics.
  - STATUS roadmap reconciliation.

- **WS2: Constraint handling**
  - Constraint model + serialization path.
  - Penalty evaluator and feasibility marker.
  - Determinism tests + integration tests.

- **WS3: Strategy composition**
  - Composition interfaces.
  - Staged strategy implementation.
  - Portfolio strategy implementation.
  - End-to-end composition integration tests.

- **WS4: Reporting**
  - Run-summary schema.
  - Comparative report utility.
  - Plot/report docs and examples.

- **WS5: Release readiness**
  - Changelog and release notes.
  - Version and compatibility checks.
  - CI baseline runtime review.

---

## Actionable prompts you can run

These prompts are written for an engineering agent (or teammate) to execute directly.

### A) ADR and roadmap alignment prompt

```text
Audit STATUS.md, docs/adr/, and v0.2 roadmap entries for drift. Propose a minimal patch that:
1) reconciles implemented vs planned items,
2) adds/updates ADRs for determinism policy and optimization composition,
3) updates STATUS.md with real dates and exact check outcomes.
Then run:
- python -m pre_commit run -a
- python -m mypy src tests
- pytest -q -m "not slow"
Commit with message: "docs: align v0.2 roadmap with ADR decisions".
```

### B) Constraint handling implementation prompt

```text
Implement deterministic constraint handling in the ML layer without changing public contracts unexpectedly.
Requirements:
- Add a reusable constraint representation (feasibility + penalty output).
- Integrate penalty handling into OptimizationRunner with deterministic behavior.
- Persist feasibility/penalty metadata in optimization outputs/logging.
- Add unit + integration tests for deterministic repeatability and metadata shape.
- Update docs/how-to-add-optimizer.md and STATUS.md.
Run required checks and commit as:
"ml: add deterministic constraint handling to optimization runner".
```

### C) Strategy composition implementation prompt

```text
Add v1 optimizer strategy composition with staged and portfolio baselines.
Requirements:
- Keep compatibility with existing OptimizerStrategy ask/tell contract.
- Implement deterministic selection/allocation behavior under fixed seeds.
- Add integration tests asserting ask/tell ordering, convergence handling, and result integrity.
- Document composition semantics in an ADR and in docs/how-to-add-optimizer.md.
- Update STATUS.md roadmap/checklists to reflect implementation reality.
Run required checks and commit as:
"ml: implement deterministic staged and portfolio strategy composition".
```

### D) Reporting improvements prompt

```text
Implement improved canonical reporting artifacts for sweep and optimization runs.
Requirements:
- Add run-summary artifact schema (best point, key metrics, provenance, seed/config hash).
- Provide helper(s) for generating summaries from canonical result contracts.
- Add tests that lock schema fields and deterministic output behavior.
- Update docs/how-to-use-harness.md and STATUS.md artifact expectations.
Run required checks and commit as:
"harness: add canonical run-summary reporting artifacts".
```

### E) Release prep prompt

```text
Prepare v0.2 release readiness update.
Requirements:
- Verify roadmap checklist items against code/tests/docs.
- Update version, release notes, and STATUS.md with exact current state.
- Run full required checks and summarize results.
- Ensure no contract-breaking change lacks an ADR/version note.
Commit as:
"release: prepare v0.2 readiness and documentation sync".
```

---

## Definition of done for this plan

The v0.2 plan is complete when:

- v0.2 roadmap items are implemented or explicitly deferred with rationale.
- Determinism and composition ADR gaps are closed.
- Constraint handling and composition are covered by fast deterministic tests.
- Reporting outputs are stable and documented for private testbench reuse.
- CI remains green with no undocumented behavior drift.
